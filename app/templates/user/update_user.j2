{% extends "base.j2" %}
{% block title %} User List {% endblock %}

{% block body %}
<div class="min-h-screen flex items-center justify-center  py-10">
    <div class="bg-white shadow-xl rounded-2xl w-full max-w-2xl p-8">

        <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">
            Update User
        </h2>

        <form action="{{ url_for('user.update_user_view', user_id=user_id)}}" method="POST" class="space-y-5"
            id="userUpdateForm">
            <input type="hidden" name="id" value="{{ (form | default({})).id | default('')}}">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600">First Name</label>
                    <input type="text" name="first_name" id="first_name"
                        value="{{ (form | default({})).first_name | default('') }}"
                        class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                    <span class="text-red-500 text-sm hidden" id="error_first_name"></span>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-600">Last Name</label>
                    <input type="text" name="last_name" id="last_name"
                        value="{{ (form | default({})).last_name | default('') }}"
                        class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                    <span class="text-red-500 text-sm hidden" id="error_last_name"></span>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-600">Email</label>
                <input type="email" name="email" id="email" value="{{ (form | default({})).email | default('') }}"
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                <span class="text-red-500 text-sm hidden" id="error_email"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-600">Phone</label>
                <input type="text" name="phone" id="phone" value="{{ (form | default({})).phone | default('') }}"
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                <span class="text-red-500 text-sm hidden" id="error_phone"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-600">Date of Birth</label>
                <input type="date" name="dob" id="dob" value="{{ (form | default({})).dob | default('') }}"
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                <span class="text-red-500 text-sm hidden" id="error_dob"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-600">Gender</label>
                <select name="gender" id="gender" value="{{ (form | default({})).gender | default('') }}"
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                    <option value="">Select Gender</option>
                    <option value="m" {% if (form | default({})).gender=='m' %}selected{% endif %}>Male</option>
                    <option value="f" {% if (form | default({})).gender=='f' %}selected{% endif %}>Female</option>
                    <option value="o" {% if (form | default({})).gender=='o' %}selected{% endif %}>Other</option>
                </select>
                <span class="text-red-500 text-sm hidden" id="error_gender"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-600">Address</label>
                <input name="address" id="address" value="{{ (form | default({})).address | default('') }}"
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none" />
                <span class="text-red-500 text-sm hidden" id="error_address"></span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-600">Role</label>
                <select name="role" id="role"
                    class="w-full mt-1 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-gray-400 outline-none">
                    <option value="">Select Role</option>
                    <option value="artist" {% if (form | default({})).role=='artist' %}selected{% endif %}>Artist
                    </option>
                    <option value="artist_manager" {% if (form | default({})).role=='artist_manager' %}selected{% endif
                        %}>Artist
                        Manager</option>
                    {% if session.get('role') == 'super_admin' %}
                    <option value="super_admin" {% if (form | default({})).role=='admin' %}selected{% endif %}>
                        Super Admin
                    </option>
                    {% endif %}
                </select>
                <span class="text-red-500 text-sm hidden" id="error_role"></span>
            </div>

            <button type="submit"
                class="w-full bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                Update
            </button>

        </form>
    </div>
</div>
<script>
    document.getElementById('userUpdateForm').addEventListener('submit', function (e) {
        e.preventDefault();
        clearErrors();

        let valid = true;

        const fields = [
            { field: document.getElementById('first_name'), rules: { required: true, minLength: 3, maxLength: 255 } },
            { field: document.getElementById('last_name'), rules: { required: true, minLength: 3, maxLength: 255 } },
            { field: document.getElementById('email'), rules: { required: true, type: 'email', maxLength: 255 } },
            { field: document.getElementById('phone'), rules: { required: true, minLength: 10, maxLength: 15 } },
            { field: document.getElementById('dob'), rules: { required: true, type: 'date', minDate: '1900-01-01', maxDate: '2023-12-31' } },
            { field: document.getElementById('gender'), rules: { required: true } },
            { field: document.getElementById('address'), rules: { required: true, minLength: 3, maxLength: 255 } },
            { field: document.getElementById('role'), rules: { required: true } }
        ];

        fields.forEach(item => {
            if (!validateField(item.field, item.rules)) valid = false;
        });

        if (valid) {
            this.submit();
        }

    });

    const serverErrors = {{ errors | default ({}) | tojson }};
    for (const field in serverErrors) {
        const span = document.getElementById(`error_${field}`);
        if (span) {
            span.textContent = serverErrors[field];
            span.classList.remove('hidden');
        }
    }

</script>
{% endblock %}